function CodeEditor(n){var t;this._options=$.extend({},{onNextStep:null,onInitComplete:null,onRunBefore:null,onRunDone:null,onRunFail:null,defaultCode:"",workspaceType:"script",instanceId:"default",gistId:null},n||{});this._options.defaultCode=this._cleanCode(this._options.defaultCode);t=`.code-runner-${this._options.instanceId}`;this._elements={editor:`${t} .editor`,runCodeText:`${t} .run-code-text`,loadingSpinner:`${t} .loading`,alertCode:`${t} .alert-code`,buttonRun:`${t} .button-run`,buttonNext:`${t} .button-next`,iframe:`${t} iframe`,codePreview:`${t} .code-preview`,outputWindow:`${t} .output-window`};this._messages={compilingMessage:"Compiling in the cloud",runErrorMessage:"Oops, something went wrong! We've been notified.",runUnknownResultMessage:"Oops, something went wrong! We've been notified."};this._executing=!1;this._compilationCounter=0;this._compilationProgressTimerID=null;this._lastStartTime=null;this._cancelRunCode=!1;this._editorOrigin="https://trydotnet.microsoft.com";this._currentCode=null;this._lastSetCode=null;this._init()}CodeEditor.prototype._init=function(){var t=this._editorOrigin+"/v2/editor?waitForConfiguration=true&instanceId="+this._options.instanceId,n;$(this._elements.iframe).attr("src",t);n=this;window.addEventListener?window.addEventListener("message",function(t){n._processEvent(t)},!1):window.attachEvent&&elem.attachEvent("onmessage",function(t){n._processEvent(t)})};CodeEditor.prototype._processEvent=function(n){var t=this;n.origin===this._editorOrigin&&n.data.messageOrigin.includes("instanceId="+this._options.instanceId)&&(n.data.type==="HostListenerReady"?(t._configureEditor(),this._options.gistId?this._postMessageToEditor({type:"setWorkspaceFromGist",gistId:this._options.gistId,canShowGitHubPanel:!0,workspaceType:this._options.workspaceType}):t.updateCode(this._options.defaultCode,!0),t._postMessageToEditor({type:"showEditor"}),$(this._elements.codePreview).hide(),$(this._elements.editor).show(),$(this._elements.loadingSpinner).hide(),$(this._elements.runCodeText).show(),$(this._elements.buttonRun).removeAttr("disabled")):n.data.type==="RunCompleted"?t._runComplete(n.data):n.data.type==="ServiceError"?t._runError(n.data):n.data.type==="CodeModified"?t._currentCode=n.data.sourceCode:n.data.type==="HostEditorReady"&&($(this._elements.buttonRun).click(function(){t.runCode()}),$(this._elements.buttonNext).click(function(){t._options.onNextStep&&t._options.onNextStep()}),t._options.onInitComplete&&t._options.onInitComplete()))};CodeEditor.prototype._configureEditor=function(){this._postMessageToEditor({type:"defineMonacoEditorThemes",themes:{newTheme:{base:"vs",inherit:!0,rules:[{token:"keyword",foreground:"512bd4"},{token:"string",foreground:"0B810B"},{token:"identifier",foreground:"D60000"},{token:"number",foreground:"0B810B"},{token:"delimiter",foreground:"333333"},],colors:{"editorLineNumber.foreground":"#666666"}}}});this._postMessageToEditor({type:"configureMonacoEditor",editorOptions:{minimap:{enabled:!1},folding:!1,theme:"newTheme",scrollBeyondLastLine:!1}})};CodeEditor.prototype.runCode=function(){var n,t;(this.hideAlert(),this._cancelRunCode=!1,this._options.onRunBefore&&(n=this._options.onRunBefore(),n===!1))||(this._compilationStart(),this._postMessageToEditor({type:"run"}),t={behavior:20,actionType:"CL",contentTags:{scn:"Interactive Code - Run Start",scnstp:this._getCodeTypeForReporting(),issuccess:"true"}},captureAction(t))};CodeEditor.prototype._runError=function(n){this._compilationEnd();this.setOutput(this._messages.runErrorMessage);this.setAlert(this._messages.runErrorMessage,"danger");var t={behavior:23,actionType:"CL",contentTags:{scn:"Interactive Code - Service Error",scnstp:`${n.statusCode} ${n.message}`,issuccess:"false"}};captureAction(t)};CodeEditor.prototype._runComplete=function(n){var t,i;if(n.outcome==="Success"){if(this._compilationEnd(),t=this._escapeOutput(n.output),this.setOutput(t),i={behavior:22,actionType:"CL",contentTags:{scn:"Interactive Code - Complete - Success",scnstp:this._getCodeTypeForReporting(),issuccess:"true"}},captureAction(i),this._options.onRunDone)this._options.onRunDone({succeeded:!0,output:t})}else if(n.outcome=="CompilationError"){if(this._compilationEnd(),t=this._escapeOutput(n.output),this.setAlert("Compilation error!","danger"),this.setOutput(t),i={behavior:23,actionType:"CL",contentTags:{scn:"Interactive Code - Complete - Compilation Error",scnstp:this._getCodeTypeForReporting(),issuccess:"false"}},captureAction(i),this._options.onRunDone)this._options.onRunDone({succeeded:!1,output:t})}else this._compilationEnd(),this.setOutput(this._messages.runUnknownResultMessage),this.setAlert(this._messages.runUnknownResultMessage,"danger"),i={behavior:23,actionType:"CL",contentTags:{scn:"Interactive Code - Unknown Result",scnstp:n.outcome,issuccess:"false"}},captureAction(i),this._options.onRunFail&&this._options.onRunFail()};CodeEditor.prototype._escapeOutput=function(n){for(var r,i=[],t=0;t<n.length;t++)r=$("<div/>").text(n[t]).html(),i.push(r);return i.join("<br />")};CodeEditor.prototype.focusEditor=function(){this._postMessageToEditor({type:"focusEditor"})};CodeEditor.prototype.getCode=function(){return this._currentCode};CodeEditor.prototype._getCodeTypeForReporting=function(){return this._currentCode==this._lastSetCode?"Default Code":"Modified Code"};CodeEditor.prototype.updateCode=function(n,t){var i=this._cleanCode(n);this._options.workspaceType==="script"?this._postMessageToEditor({type:"setWorkspace",workspace:{workspaceType:"console",files:[{name:"Program.cs",text:"using System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nnamespace MyCodeSample\n{\n public class Program\n {\n public static void Main()\n {\n #region code\n #endregion\n }\n }\n}"}],buffers:[{id:"Program.cs@code",content:i,position:0}]},bufferId:"Program.cs@code"}):this._postMessageToEditor({type:"setWorkspace",workspace:{workspaceType:this._options.workspaceType,buffers:[{id:"Program.cs",content:i,position:0}]},bufferId:"Program.cs"});this._currentCode=i;t&&(this._lastSetCode=i)};CodeEditor.prototype._cleanCode=function(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};CodeEditor.prototype.setOutput=function(n){$(this._elements.outputWindow).html(n)};CodeEditor.prototype.setAlert=function(n,t){$(this._elements.alertCode).html(n);$(this._elements.alertCode).removeClass("alert-warning").removeClass("alert-danger").removeClass("alert-success");$(this._elements.alertCode).addClass("alert-"+t);$(this._elements.alertCode).show()};CodeEditor.prototype.showAlert=function(){$(this._elements.alertCode).show()};CodeEditor.prototype.hideNextButton=function(){$(this._elements.buttonNext).hide()};CodeEditor.prototype.showNextButton=function(){$(this._elements.buttonNext).show()};CodeEditor.prototype.hideAlert=function(){$(this._elements.alertCode).hide()};CodeEditor.prototype._compilationStart=function(){this._executing=!0;this._compilationCounter=0;this._compilationProgressTimerID=window.setTimeout(this._compilationProgressTimerOut.bind(this),100);this.setOutput(this._messages.compilingMessage);this._lastStartTime=(new Date).getTime()};CodeEditor.prototype._compilationEnd=function(){this._executing=!1;window.clearTimeout(this._compilationProgressTimerID);var n=(new Date).getTime()-this._lastStartTime,t={behavior:21,actionType:"CL",contentTags:{scn:"Interactive Code - Run",scnstp:`Time elapsed ${n}`,issuccess:"true"}};captureAction(t)};CodeEditor.prototype._compilationProgressTimerOut=function(){if(this._executing){var n=this._oscillate(this._compilationCounter,1,3),t=Array(n+1).join(".");this.setOutput("<span aria-hidden='true'>"+this._messages.compilingMessage+t+"<\/span>");this._compilationCounter++;this._compilationProgressTimerID=window.setTimeout(this._compilationProgressTimerOut.bind(this),100)}};CodeEditor.prototype._oscillate=function(n,t,i){var r=i-t;return t+Math.abs((n+r)%(r*2)-r)};CodeEditor.prototype._postMessageToEditor=function(n){$(this._elements.iframe).get(0).contentWindow.postMessage(n,this._editorOrigin)};